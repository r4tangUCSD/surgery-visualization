<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSC106 Project 3</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="global.js"></script>
    <script src="index.js" type="module" defer></script>
</head>
<body>
    <h1>Interactive Surgery Visualization</h1>
    <div class="container">
        <div class="silhouette-container" id="silhouette"></div>
        <div class="plot-container" id="plot">
            <p id="plot-message">Click on a point to see details</p>
        </div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        // main configuration
        const width = 800;  
        const height = 1000; 
        const pointSize = 12; 
        const hoverRadius = 30; 
        
        // values to plot point anatomically
        const points = [
            { id: 1, x: 399, y: 563, name: "Colorectal" },        // lower abdomen
            { id: 2, x: 399, y: 375, name: "Stomach" },           // upper abdomen
            { id: 3, x: 439, y: 438, name: "Biliary/Pancreas" },  // right upper abdomen
            { id: 4, x: 399, y: 500, name: "Vascular" },          // central/left abdomen
            { id: 5, x: 299, y: 313, name: "Breast" },            // left chest
            { id: 6, x: 359, y: 400, name: "Hepatic" },           // right upper abdomen (liver)
            { id: 7, x: 399, y: 225, name: "Thyroid" }            // neck
        ];
        
        // tracking for selected points
        const selectedPoints = new Set();
        let activePoint = null;
        
        // create SVG for silhouette
        const svg = d3.select("#silhouette")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        
        // add the silhouette image
        svg.append("image")
            .attr("href", "images/male_figure.png") // path to  silhouette image --> WOULD NEED A VARIABLE TO CHANGE
            .attr("width", width)
            .attr("height", height)
            .attr("preserveAspectRatio", "xMidYMid meet");
        
        // create points
        const diamonds = svg.selectAll(".point")
            .data(points)
            .enter()
            .append("path")
            .attr("class", "point")
            .attr("d", d => {
                return `M${d.x},${d.y-pointSize} L${d.x+pointSize},${d.y} L${d.x},${d.y+pointSize} L${d.x-pointSize},${d.y} Z`;
            })
            .attr("fill", "#000000") // black by default
            .attr("stroke", "#444444")
            .attr("stroke-width", 1.5);
        
        // get tooltip element
        const tooltip = d3.select("#tooltip");
        
        // larger area for easier hovering
        const hoverAreas = svg.selectAll(".hover-area")
            .data(points)
            .enter()
            .append("circle")
            .attr("class", "hover-area")
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", hoverRadius)
            .attr("fill", "transparent")
            .style("pointer-events", "all")
            .on("mouseover", function(event, d) {
                // change color if this isn't the active point
                if (activePoint !== d.id) {
                    d3.select(diamonds.nodes()[d.id-1])
                        .attr("fill", "#FF0000")
                        .attr("stroke", "#CC0000");
                }
    
                // show tooltip regardless
                tooltip
                .style("opacity", 1)
                .html(d.name)
                .style("left", (d.x + 15) + "px")
                .style("top", (d.y - 15) + "px");
            })
            .on("mouseout", function(event, d) {
                // reset to black if not the active point
                if (activePoint !== d.id) {
                    d3.select(diamonds.nodes()[d.id-1])
                        .attr("fill", "#000000")
                        .attr("stroke", "#444444");
                } else {
                    // if active point, ensure it stays red
                    d3.select(diamonds.nodes()[d.id-1])
                    .attr("fill", "#FF0000")
                    .attr("stroke", "#CC0000");
                }
    
                // hide tooltip
                tooltip.style("opacity", 0);
            })
            .on("click", function(event, d) {
                // if clicking on the currently active point, deselect it
                if (activePoint === d.id) {
                    // reset its color to black
                    d3.select(diamonds.nodes()[d.id-1])
                        .attr("fill", "#000000")
                        .attr("stroke", "#444444");
        
                    // clear the active point and plot
                    activePoint = null;
                    clearPlot();
            } else {
                // if there's already an active point, reset its color
                if (activePoint !== null) {
                    d3.select(diamonds.nodes()[activePoint-1])
                        .attr("fill", "#000000")
                        .attr("stroke", "#444444");
                }
        
                // set this as the new active point
                activePoint = d.id;
        
                // change its color to red
                d3.select(diamonds.nodes()[d.id-1])
                    .attr("fill", "#FF0000")
                    .attr("stroke", "#CC0000");
        
                // show its plot
                showPlot(d);
            }
        });
            
        
        // function to show plot for a point --> PLACEHOLDER
        function showPlot(point) {
            const plotContainer = d3.select("#plot");
            
            // clear previous plot content
            plotContainer.html("");
            
            // create SVG for the plot
            const plotSvg = plotContainer.append("svg")
                .attr("width", 800)
                .attr("height", 500);
            
            // add placeholder text --> TO CHANGE
            plotSvg.append("text")
                .attr("x", 250)
                .attr("y", 400)
                .attr("text-anchor", "middle")
                .text(`${point.name} Condition Detail`);
            
            // CALL PLOTTING FUNCTION HERE
            // plotFunction(point.id, plotSvg);
        }
        
        // function to clear the plot
        function clearPlot() {
            d3.select("#plot").html('<p id="plot-message">Click on a point to see details</p>');
        }
    </script>
</body>
</html>